gulp        = require 'gulp'
mocha       = require 'gulp-mocha'
uglify      = require 'gulp-uglify'
gutil       = require 'gulp-util'
coffee      = require 'gulp-coffee'
runSequence = require 'run-sequence'

COFFEE_SRC = './src/**/*.coffee'

gulp.task 'build', ->
  gulp.src COFFEE_SRC
  .pipe coffee()
  .pipe uglify()
  .on 'error', gutil.log
  .pipe gulp.dest('build')

gulp.task 'test', ->
  gulp.src('test/index.spec.coffee', {read: false})
  .pipe(mocha({
    reporter: 'spec',
    compilers: 'coffee:coffee-script'
    require: 'test/helper.coffee'
    timeout: 30000
  }))

gulp.task 'watch', ->
  gulp.watch(COFFEE_SRC, ['build'])

gulp.task 'default', ['build']
